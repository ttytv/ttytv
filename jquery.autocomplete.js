$.browser=navigator.userAgent,function(w){w.fn.extend({autocomplete:function(e,t){var n="string"==typeof e;return(t=w.extend({},w.Autocompleter.defaults,{url:n?e:null,data:n?null:e,delay:n?w.Autocompleter.defaults.delay:10,max:t&&!t.scroll?10:150},t)).highlight=t.highlight||function(e){return e},t.formatMatch=t.formatMatch||t.formatItem,this.each(function(){new w.Autocompleter(this,t)})},result:function(e){return this.bind("result",e)},search:function(e){return this.trigger("search",[e])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(e){return this.trigger("setOptions",[e])},unautocomplete:function(){return this.trigger("unautocomplete")}}),w.Autocompleter=function(l,s){var t,a,n,i={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},u=w(l).attr("autocomplete","off").addClass(s.inputClass),c="",r=w.Autocompleter.Cache(s),o=0,e={mouseDownOnSelect:!1},h=w.Autocompleter.Select(s,l,f,e);function f(){var e,t,n,a,i,r,o=h.selected();return!!o&&(e=o.result,c=e,s.multiple&&(1<(t=m(u.val())).length&&(n=s.multipleSeparator.length,a=w(l).selection().start,r=0,w.each(t,function(e,t){if(r+=t.length,a<=r)return i=e,!1;r+=n}),t[i]=e,e=t.join(s.multipleSeparator)),e+=s.multipleSeparator),u.val(e),g(),u.trigger("result",[o.data,o.value]),!0)}function d(e,t){var n;a==i.DEL?h.hide():(n=u.val(),!t&&n==c||((n=p(c=n)).length>=s.minChars?(u.addClass(s.loadingClass),C(n=s.matchCase?n:n.toLowerCase(),v,g)):(b(),h.hide())))}function m(t){return t?s.multiple?w.map(t.split(s.multipleSeparator),function(e){return w.trim(t).length?w.trim(e):null}):[w.trim(t)]:[""]}function p(e){var t,n;return s.multiple?1==(n=m(e)).length?n[0]:(n=(t=w(l).selection().start)==e.length?m(e):m(e.replace(e.substring(t),"")))[n.length-1]:e}function g(){h.visible();h.hide(),clearTimeout(t),b(),s.mustMatch&&u.search(function(e){e||(s.multiple?(e=m(u.val()).slice(0,-1),u.val(e.join(s.multipleSeparator)+(e.length?s.multipleSeparator:""))):(u.val(""),u.trigger("result",null)))})}function v(e,t){t&&t.length&&o?(b(),h.display(t,e),e=e,t=t[0].value,s.autoFill&&p(u.val()).toLowerCase()==e.toLowerCase()&&a!=i.BACKSPACE&&(u.val(u.val()+t.substring(p(c).length)),w(l).selection(c.length,c.length+t.length)),h.show()):g()}function C(t,n,e){s.matchCase||(t=t.toLowerCase());var a,i=r.load(t);i&&i.length?n(t,i):"string"==typeof s.url&&0<s.url.length?(a={timestamp:+new Date},w.each(s.extraParams,function(e,t){a[e]="function"==typeof t?t():t}),w.ajax({mode:"abort",port:"autocomplete"+l.name,dataType:s.dataType,url:s.url,data:w.extend({wd:p(t),limit:s.max},a),success:function(e){e=s.parse&&s.parse(e)||function(e){for(var t=[],n=e.split("\n"),a=0;a<n.length;a++){var i=w.trim(n[a]);i&&(i=i.split("|"),t[t.length]={data:i,value:i[0],result:s.formatResult&&s.formatResult(i,i[0])||i[0]})}return t}(e);r.add(t,e),n(t,e)}})):(h.emptyList(),e(t))}function b(){u.removeClass(s.loadingClass)}w.browser.opera&&w(l.form).bind("submit.autocomplete",function(){if(n)return n=!1}),u.bind((w.browser.opera?"keypress":"keydown")+".autocomplete",function(e){switch(o=1,a=e.keyCode,e.keyCode){case i.UP:e.preventDefault(),h.visible()?h.prev():d(0,!0);break;case i.DOWN:e.preventDefault(),h.visible()?h.next():d(0,!0);break;case i.PAGEUP:e.preventDefault(),h.visible()?h.pageUp():d(0,!0);break;case i.PAGEDOWN:e.preventDefault(),h.visible()?h.pageDown():d(0,!0);break;case s.multiple&&","==w.trim(s.multipleSeparator)&&i.COMMA:case i.TAB:if(f())return e.preventDefault(),!(n=!0);break;case i.RETURN:clearTimeout(t),t=setTimeout(d,s.delay);break;case i.ESC:h.hide();break;default:clearTimeout(t),t=setTimeout(d,s.delay)}}).focus(function(){o++}).blur(function(){o=0,e.mouseDownOnSelect||(clearTimeout(t),t=setTimeout(g,200))}).click(function(){1<o++&&!h.visible()&&d(0,!0)}).bind("search",function(){var i=1<arguments.length?arguments[1]:null;function n(e,t){var n;if(t&&t.length)for(var a=0;a<t.length;a++)if(t[a].result.toLowerCase()==e.toLowerCase()){n=t[a];break}"function"==typeof i?i(n):u.trigger("result",n&&[n.data,n.value])}w.each(m(u.val()),function(e,t){C(t,n,n)})}).bind("flushCache",function(){r.flush()}).bind("setOptions",function(){w.extend(s,arguments[1]),"data"in arguments[1]&&r.populate()}).bind("unautocomplete",function(){h.unbind(),u.unbind(),w(l.form).unbind(".autocomplete")})},w.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:10,max:100,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(e){return e[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",highlight:function(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180},w.Autocompleter.Cache=function(l){var r={},o=0;function s(e,t){var n=(e=l.matchCase?e:e.toLowerCase()).indexOf(t);return-1!=(n="word"==l.matchContains?e.toLowerCase().search("\\b"+t.toLowerCase()):n)&&(0==n||l.matchContains)}function u(e,t){o>l.cacheLength&&n(),r[e]||o++,r[e]=t}function e(){if(!l.data)return!1;var e={},t=0;l.url||(l.cacheLength=1),e[""]=[];for(var n=0,a=l.data.length;n<a;n++){var i,r=l.data[n],o=l.formatMatch(r="string"==typeof r?[r]:r,n+1,l.data.length);!1!==o&&(e[i=o.charAt(0).toLowerCase()]||(e[i]=[]),r={value:o,data:r,result:l.formatResult&&l.formatResult(r)||o},e[i].push(r),t++<l.max)&&e[""].push(r)}w.each(e,function(e,t){l.cacheLength++,u(e,t)})}function n(){r={},o=0}return setTimeout(e,25),{flush:n,add:u,populate:e,load:function(n){if(l.cacheLength&&o){if(!l.url&&l.matchContains){var e,a=[];for(e in r)0<e.length&&(t=r[e],w.each(t,function(e,t){s(t.value,n)&&a.push(t)}));return a}if(r[n])return r[n];if(l.matchSubset)for(var t,i=n.length-1;i>=l.minChars;i--)if(t=r[n.substr(0,i)])return a=[],w.each(t,function(e,t){s(t.value,n)&&(a[a.length]=t)}),a}return null}}},w.Autocompleter.Select=function(i,n,a,r){var o,l,s,u,c,h="ac_over",f=-1,d=!0;function m(e){for(var t=e.target;t&&"LI"!=t.tagName;)t=t.parentNode;return t||[]}function e(e){o.slice(f,f+1).removeClass(h),(f+=e)<0?f=o.size()-1:f>=o.size()&&(f=0);var t,e=o.slice(f,f+1).addClass(h);i.scroll&&(t=0,o.slice(0,f).each(function(){t+=this.offsetHeight}),t+e[0].offsetHeight-c.scrollTop()>c[0].clientHeight?c.scrollTop(t+e[0].offsetHeight-c.innerHeight()):t<c.scrollTop()&&c.scrollTop(t))}function p(){c.empty();e=l.length;for(var e,t,n=i.max&&i.max<e?i.max:e,a=0;a<n;a++)l[a]&&!1!==(t=i.formatItem(l[a].data,a+1,n,l[a].value,s))&&(t=w("<li/>").html(i.highlight(t,s)).addClass(a%2==0?"ac_even":"ac_odd").appendTo(c)[0],w.data(t,"ac_data",l[a]));o=c.find("li"),i.selectFirst&&(o.slice(0,1).addClass(h),f=0),w.fn.bgiframe&&c.bgiframe()}return{display:function(e,t){d&&(u=w("<div/>").hide().addClass(i.resultsClass).css("position","absolute").appendTo(document.body),c=w("<ul/>").appendTo(u).mouseover(function(e){m(e).nodeName&&"LI"==m(e).nodeName.toUpperCase()&&(f=w("li",c).removeClass(h).index(m(e)),w(m(e)).addClass(h))}).click(function(e){return w(m(e)).addClass(h),a(),n.focus(),!1}).mousedown(function(){r.mouseDownOnSelect=!0}).mouseup(function(){r.mouseDownOnSelect=!1}),0<i.width&&u.css("width",i.width),d=!1),l=e,s=t,p()},next:function(){e(1)},prev:function(){e(-1)},pageUp:function(){e(0!=f&&f-8<0?-f:-8)},pageDown:function(){f!=o.size()-1&&f+8>o.size()?e(o.size()-1-f):e(8)},hide:function(){u&&u.hide(),o&&o.removeClass(h),f=-1},visible:function(){return u&&u.is(":visible")},current:function(){return this.visible()&&(o.filter("."+h)[0]||i.selectFirst&&o[0])},show:function(){var e,t=w(n).offset();u.css({width:"string"==typeof i.width||0<i.width?i.width:w(n).width(),top:t.top+n.offsetHeight,left:t.left}).show(),i.scroll&&(c.scrollTop(0),c.css({maxHeight:i.scrollHeight,overflow:"auto"}),w.browser.msie)&&void 0===document.body.style.maxHeight&&(e=0,o.each(function(){e+=this.offsetHeight}),t=e>i.scrollHeight,c.css("height",t?i.scrollHeight:e),t||o.width(c.width()-parseInt(o.css("padding-left"))-parseInt(o.css("padding-right"))))},selected:function(){var e=o&&o.filter("."+h).removeClass(h);return e&&e.length&&w.data(e[0],"ac_data")},emptyList:function(){c&&c.empty()},unbind:function(){u&&u.remove()}}},w.fn.selection=function(t,n){var e,a,i,r;return void 0!==t?this.each(function(){var e;this.createTextRange?(e=this.createTextRange(),void 0===n||t==n?e.move("character",t):(e.collapse(!0),e.moveStart("character",t),e.moveEnd("character",n)),e.select()):this.setSelectionRange?this.setSelectionRange(t,n):this.selectionStart&&(this.selectionStart=t,this.selectionEnd=n)}):(e=this[0]).createTextRange?(r=document.selection.createRange(),a=e.value,i=r.text.length,r=e.value.indexOf(r.text="<->"),e.value=a,this.selection(r,r+i),{start:r,end:r+i}):void 0!==e.selectionStart?{start:e.selectionStart,end:e.selectionEnd}:void 0}}(jQuery);